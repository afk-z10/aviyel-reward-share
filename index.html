<html>
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css"
  />
  <form id="form">
    <div>
      <label>Production</label>
      <input type="checkbox" name="production" />
    </div>
    <div>
      <label>Aviyel username</label>
      <input type="text" name="username" value="afk-z10" />
    </div>
    <div>
      <label>Aviyel Project-ID</label>
      <input type="number" name="project" value="110" />
    </div>
    <button>Submit</button>
  </form>
  <article />
  <script type="module">
    document.addEventListener("click", (e) => {
      /**@type {HTMLElement}*/
      const button = e.target;
      if (button.id === "copy") {
        navigator.clipboard
          .writeText(
            `[![Rewards image](${button.dataset.url})](${button.dataset.link})`
          )
          .then(() => {
            alert("Copied to clipboard");
          });
      }
    });
    const form = document.querySelector("form");
    form.onsubmit = (e) => {
      e.preventDefault();
      const x = new FormData(form);
      const username = x.get("username");
      const projectId = x.get("project");
      const isProd = x.get("production") === "on";

      const BETA_DOMAIN = "https://beta.aviyel.com";
      const DOMAIN = "https://aviyel.com";
      const host = isProd ? DOMAIN : BETA_DOMAIN;

      const url = `${location.origin}/${username}/${projectId}/readme.svg${
        isProd ? "" : "?beta"
      }`;
      const linkURL = `${host}/user/${username}/${projectId}/rewards?log`;

      const article = document.querySelector("article");
      article.innerHTML = `<a href="${url}" target="_blank"><img src="${url}" /></a><section><button id="copy" data-link="${linkURL}" data-url="${url}">Copy Markdown</button></section>`;
    };
  </script>
</html>
